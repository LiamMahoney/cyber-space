<?xml version="1.0"?>
<configuration>
 <system.webServer>
  <handlers>
    <add name="iisnode" path="/index.js" verb="*" modules="iisnode" />
  </handlers>
  <rewrite>
  <rules>
    <rule name="Root Hit Redirect" stopProcessing="true">
        <match url="^$" />
        <action type="Rewrite" url="/public/index.html" />
    </rule>
    <!-- First we consider whether the incoming URL matches a physical file in the /public folder -->
    <rule name="StaticContent" patternSyntax="Wildcard">
        <action type="Rewrite" url="public/{R:0}" logRewrittenUrl="true"/>
        <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true"/>
        </conditions>
        <match url="*"/>
    </rule>
    <!-- e.g. http://host/public/folder where 'folder' is a directory -->
    <rule name="DirectoryWithoutSlash" patternSyntax="ECMAScript">
        <match url="(.*)/(.+[^/]$)"/>
        <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory"/>
        </conditions>
        <action type="Rewrite" url="index.html"/>
    </rule>
    <!-- All other URLs are mapped to the Node.js application entry point -->
    <rule name="DynamicContent">
      <conditions>
        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True"/>
      </conditions>
      <action type="Rewrite" url="/index.js"/>
    </rule>
  </rules>
</rewrite>
</system.webServer>
</configuration>